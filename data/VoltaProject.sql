DROP DATABASE IF EXISTS `votadb`;

CREATE DATABASE `votadb`;

use `votadb`;


CREATE TABLE `User` (
  `user_id` int UNIQUE PRIMARY KEY NOT NULL AUTO_INCREMENT,
  `customer_name` varchar(255),
  `user_mail` varchar(255) UNIQUE NOT NULL,
  `user_country_id` int,
  `user_city` varchar(255),
  `user_cp` int,
  `user_tel` int UNIQUE,
  `user_tel_prefix` varchar(255),
  `user_pass` varchar(255),
  `token` varchar(255) UNIQUE,
  `is_mail_valid` boolean DEFAULT false,
  `conditions_accepted` boolean DEFAULT false
);

CREATE TABLE `Country` (
  `country_id` int UNIQUE PRIMARY KEY NOT NULL AUTO_INCREMENT,
  `country_code` varchar(255) NOT NULL,
  `country_name` varchar(255) NOT NULL,
  `tel_prefix` varchar(255)
);

CREATE TABLE `Survey` (
  `survey_id` int UNIQUE PRIMARY KEY NOT NULL AUTO_INCREMENT,
  `user_id` int NOT NULL,
  `survey_title` varchar(255) NOT NULL,
  `start_date` datetime NOT NULL,
  `end_date` datetime NOT NULL,
  `public_title` ENUM('public', 'private', 'hidden') NOT NULL DEFAULT 'hidden',
  `public_results` ENUM('public', 'private', 'hidden') NOT NULL DEFAULT 'hidden',
  `imag` varchar(255)
);

CREATE TABLE `SurveyOption` (
  `option_id` int UNIQUE PRIMARY KEY NOT NULL AUTO_INCREMENT,
  `option_text` varchar(255) NOT NULL,
  `survey_id` int NOT NULL,
  `imag` varchar(255)
);

CREATE TABLE `Invitation` (
  `invitation_id` int UNIQUE PRIMARY KEY NOT NULL AUTO_INCREMENT,
  `mail_to` varchar(255) NOT NULL,
  `survey_id` int NOT NULL,
  `is_send` boolean NOT NULL DEFAULT false,
  `is_survey_done` boolean NOT NULL DEFAULT false,
  `invitation_token` varchar(255) UNIQUE NOT NULL
);

CREATE TABLE `UserVote` (
  `user_id` int NOT NULL,
  `option_id` int NOT NULL
);



ALTER TABLE `Survey` ADD CONSTRAINT FK_Survey_User
FOREIGN KEY (`user_id`)
    REFERENCES `User` (`user_id`);

ALTER TABLE `SurveyOption` ADD CONSTRAINT FK_Option_Survey
FOREIGN KEY (`survey_id`)
    REFERENCES `Survey` (`survey_id`);

ALTER TABLE `User` ADD CONSTRAINT FK_User_Country_ID
FOREIGN KEY (`user_country_id`)
    REFERENCES `Country` (`country_id`);

ALTER TABLE `Invitation` ADD CONSTRAINT FK_Invitation_Survey
FOREIGN KEY (`survey_id`)
    REFERENCES `Survey` (`survey_id`);

ALTER TABLE `Invitation` ADD CONSTRAINT FK_Invitation_User
FOREIGN KEY (`mail_to`)
    REFERENCES User (`user_mail`);

ALTER TABLE `UserVote` ADD CONSTRAINT FK_UserVote_Option
FOREIGN KEY (`option_id`)
    REFERENCES `SurveyOption` (`option_id`);

ALTER TABLE `UserVote` ADD CONSTRAINT FK_UserVote_User
FOREIGN KEY (`user_id`)
    REFERENCES User (`user_id`);



INSERT INTO `Country` (country_code, country_name, tel_prefix) VALUES
('AF', 'Afganistán', '+93'),
('AX', 'Islas Gland', '+358'),
('AL', 'Albania', '+355'),
('DE', 'Alemania', '+49'),
('AD', 'Andorra', '+376'),
('AO', 'Angola', '+244'),
('AI', 'Anguilla', '+1'),
('AQ', 'Antártida', '+672'),
('AG', 'Antigua y Barbuda', '+1'),
('AN', 'Antillas Holandesas', '+599'),
('SA', 'Arabia Saudí', '+966'),
('DZ', 'Argelia', '+213'),
('AR', 'Argentina', '+54'),
('AM', 'Armenia', '+374'),
('AW', 'Aruba', '+297'),
('AU', 'Australia', '+61'),
('AT', 'Austria', '+43'),
('AZ', 'Azerbaiyán', '+994'),
('BS', 'Bahamas', '+1'),
('BH', 'Bahréin', '+973'),
('BD', 'Bangladesh', '+880'),
('BB', 'Barbados', '+1'),
('BY', 'Bielorrusia', '+375'),
('BE', 'Bélgica', '+32'),
('BZ', 'Belice', '+501'),
('BJ', 'Benin', '+229'),
('BM', 'Bermudas', '+1'),
('BT', 'Bhután', '+975'),
('BO', 'Bolivia', '+591'),
('BA', 'Bosnia y Herzegovina', '+387'),
('BW', 'Botsuana', '+267'),
('BV', 'Isla Bouvet', '+47'),
('BR', 'Brasil', '+55'),
('BN', 'Brunéi', '+673'),
('BG', 'Bulgaria', '+359'),
('BF', 'Burkina Faso', '+226'),
('BI', 'Burundi', '+257'),
('CV', 'Cabo Verde', '+238'),
('KY', 'Islas Caimán', '+1'),
('KH', 'Camboya', '+855'),
('CM', 'Camerún', '+237'),
('CA', 'Canadá', '+1'),
('CF', 'República Centroafricana', '+236'),
('TD', 'Chad', '+235'),
('CZ', 'República Checa', '+420'),
('CL', 'Chile', '+56'),
('CN', 'China', '+86'),
('CY', 'Chipre', '+357'),
('CX', 'Isla de Navidad', '+61'),
('VA', 'Ciudad del Vaticano', '+39'),
('CC', 'Islas Cocos', '+61'),
('CO', 'Colombia', '+57'),
('KM', 'Comoras', '+269'),
('CD', 'República Democrática del Congo', '+243'),
('CG', 'Congo', '+242'),
('CK', 'Islas Cook', '+682'),
('KP', 'Corea del Norte', '+850'),
('KR', 'Corea del Sur', '+82'),
('CI', 'Costa de Marfil', '+225'),
('CR', 'Costa Rica', '+506'),
('HR', 'Croacia', '+385'),
('CU', 'Cuba', '+53'),
('DK', 'Dinamarca', '+45'),
('DM', 'Dominica', '+1'),
('DO', 'República Dominicana', '+1'),
('EC', 'Ecuador', '+593'),
('EG', 'Egipto', '+20'),
('SV', 'El Salvador', '+503'),
('AE', 'Emiratos Árabes Unidos', '+971'),
('ER', 'Eritrea', '+291'),
('SK', 'Eslovaquia', '+421'),
('SI', 'Eslovenia', '+386'),
('ES', 'España', '+34'),
('UM', 'Islas ultramarinas de Estados Unidos', '+1'),
('US', 'Estados Unidos', '+1'),
('EE', 'Estonia', '+372'),
('ET', 'Etiopía', '+251'),
('FO', 'Islas Feroe', '+298'),
('PH', 'Filipinas', '+63'),
('FI', 'Finlandia', '+358'),
('FJ', 'Fiyi', '+679'),
('FR', 'Francia', '+33'),
('GA', 'Gabón', '+241'),
('GM', 'Gambia', '+220'),
('GE', 'Georgia', '+995'),
('GS', 'Islas Georgias del Sur y Sandwich del Sur', '+500'),
('GH', 'Ghana', '+233'),
('GI', 'Gibraltar', '+350'),
('GD', 'Granada', '+1'),
('GR', 'Grecia', '+30'),
('GL', 'Groenlandia', '+299'),
('GP', 'Guadalupe', '+590'),
('GU', 'Guam', '+1'),
('GT', 'Guatemala', '+502'),
('GF', 'Guayana Francesa', '+594'),
('GN', 'Guinea', '+224'),
('GQ', 'Guinea Ecuatorial', '+240'),
('GW', 'Guinea-Bissau', '+245'),
('GY', 'Guyana', '+592'),
('HT', 'Haití', '+509'),
('HM', 'Islas Heard y McDonald', '+61'),
('HN', 'Honduras', '+504'),
('HK', 'Hong Kong', '+852'),
('HU', 'Hungría', '+36'),
('IN', 'India', '+91'),
('ID', 'Indonesia', '+62'),
('IR', 'Irán', '+98'),
('IQ', 'Iraq', '+964'),
('IE', 'Irlanda', '+353'),
('IS', 'Islandia', '+354'),
('IL', 'Israel', '+972'),
('IT', 'Italia', '+39'),
('JM', 'Jamaica', '+1'),
('JP', 'Japón', '+81'),
('JO', 'Jordania', '+962'),
('KZ', 'Kazajstán', '+7'),
('KE', 'Kenia', '+254'),
('KG', 'Kirguistán', '+996'),
('KI', 'Kiribati', '+686'),
('KW', 'Kuwait', '+965'),
('LA', 'Laos', '+856'),
('LS', 'Lesotho', '+266'),
('LV', 'Letonia', '+371'),
('LB', 'Líbano', '+961'),
('LR', 'Liberia', '+231'),
('LY', 'Libia', '+218'),
('LI', 'Liechtenstein', '+423'),
('LT', 'Lituania', '+370'),
('LU', 'Luxemburgo', '+352'),
('MO', 'Macao', '+853'),
('MK', 'ARY Macedonia', '+389'),
('MG', 'Madagascar', '+261'),
('MY', 'Malasia', '+60'),
('MW', 'Malawi', '+265'),
('MV', 'Maldivas', '+960'),
('ML', 'Malí', '+223'),
('MT', 'Malta', '+356'),
('FK', 'Islas Malvinas', '+500'),
('MP', 'Islas Marianas del Norte', '+1'),
('MA', 'Marruecos', '+212'),
('MH', 'Islas Marshall', '+692'),
('MQ', 'Martinica', '+596'),
('MU', 'Mauricio', '+230'),
('MR', 'Mauritania', '+222'),
('YT', 'Mayotte', '+262'),
('MX', 'México', '+52'),
('FM', 'Micronesia', '+691'),
('MD', 'Moldavia', '+373'),
('MC', 'Mónaco', '+377'),
('MN', 'Mongolia', '+976'),
('MS', 'Montserrat', '+1'),
('MZ', 'Mozambique', '+258'),
('MM', 'Birmania', '+95'),
('NA', 'Namibia', '+264'),
('NR', 'Nauru', '+674'),
('NP', 'Nepal', '+977'),
('NI', 'Nicaragua', '+505'),
('NE', 'Níger', '+227'),
('NG', 'Nigeria', '+234'),
('NU', 'Niue', '+683'),
('NF', 'Norfolk', '+672'),
('NO', 'Noruega', '+47'),
('NC', 'Nueva Caledonia', '+687'),
('NZ', 'Nueva Zelanda', '+64'),
('OM', 'Omán', '+968'),
('NL', 'Países Bajos', '+31'),
('PK', 'Pakistán', '+92'),
('PW', 'Palau', '+680'),
('PS', 'Territorio Palestino', '+970'),
('PA', 'Panamá', '+507'),
('PG', 'Papúa Nueva Guinea', '+675'),
('PY', 'Paraguay', '+595'),
('PE', 'Perú', '+51'),
('PN', 'Islas Pitcairn', '+64'),
('PF', 'Polinesia Francesa', '+689'),
('PL', 'Polonia', '+48'),
('PT', 'Portugal', '+351'),
('PR', 'Puerto Rico', '+1'),
('QA', 'Qatar', '+974'),
('GB', 'Reino Unido', '+44'),
('RE', 'Reunión', '+262'),
('RW', 'Ruanda', '+250'),
('RO', 'Rumania', '+40'),
('RU', 'Rusia', '+7'),
('EH', 'Sahara Occidental', '+212'),
('WS', 'Samoa', '+685'),
('AS', 'Samoa Americana', '+1'),
('BL', 'San Bartolomé', '+590'),
('KN', 'San Cristóbal y Nieves', '+1'),
('SM', 'San Marino', '+378'),
('MF', 'San Martín', '+590'),
('PM', 'San Pedro y Miquelón', '+508'),
('VC', 'San Vicente y las Granadinas', '+1'),
('SH', 'Santa Helena', '+290'),
('LC', 'Santa Lucía', '+1'),
('ST', 'Santo Tomé y Príncipe', '+239'),
('SN', 'Senegal', '+221'),
('RS', 'Serbia', '+381'),
('SC', 'Seychelles', '+248'),
('SL', 'Sierra Leona', '+232'),
('SG', 'Singapur', '+65'),
('SY', 'Siria', '+963'),
('SO', 'Somalia', '+252'),
('LK', 'Sri Lanka', '+94'),
('SZ', 'Suazilandia', '+268'),
('ZA', 'Sudáfrica', '+27'),
('SD', 'Sudán', '+249'),
('SE', 'Suecia', '+46'),
('CH', 'Suiza', '+41'),
('SR', 'Surinam', '+597'),
('SJ', 'Svalbard y Jan Mayen', '+47'),
('TH', 'Tailandia', '+66'),
('TW', 'Taiwán', '+886'),
('TZ', 'Tanzania', '+255'),
('TJ', 'Tayikistán', '+992'),
('IO', 'Territorio Británico del Océano Índico', '+246'),
('TF', 'Territorios Australes Franceses', '+262'),
('TL', 'Timor Oriental', '+670'),
('TG', 'Togo', '+228'),
('TK', 'Tokelau', '+690'),
('TO', 'Tonga', '+676'),
('TT', 'Trinidad y Tobago', '+1'),
('TN', 'Túnez', '+216'),
('TC', 'Islas Turcas y Caicos', '+1'),
('TM', 'Turkmenistán', '+993'),
('TR', 'Turquía', '+90'),
('TV', 'Tuvalu', '+688'),
('UA', 'Ucrania', '+380'),
('UG', 'Uganda', '+256'),
('UY', 'Uruguay', '+598'),
('UZ', 'Uzbekistán', '+998'),
('VU', 'Vanuatu', '+678'),
('VE', 'Venezuela', '+58'),
('VN', 'Vietnam', '+84'),
('VG', 'Islas Vírgenes Británicas', '+1'),
('VI', 'Islas Vírgenes de los Estados Unidos', '+1'),
('WF', 'Wallis y Futuna', '+681'),
('YE', 'Yemen', '+967'),
('DJ', 'Yibuti', '+253'),
('ZM', 'Zambia', '+260'),
('ZW', 'Zimbabue', '+263');